trigger: none

jobs:
# Container job: probe the container network gateway for a registry/Docker API
- job: Linux_Container_GatewayProbe
  displayName: Linux (container) gateway probe
  pool:
    vmImage: 'ubuntu-latest'
  container:
    image: ubuntu:24.04
    # (Alternative to sudo) options: '--user 0:0'
  steps:
  - bash: |
      set -euo pipefail
      sudo apt-get update -y
      sudo apt-get install -y curl iproute2 netcat-traditional
      PORTS="5000 5001 2375 2376 80 443 8080"
      GW=$(ip route | awk '/default/ {print $3; exit}'); echo "GW=$GW"
      for p in $PORTS; do nc -z -w1 "$GW" "$p" && echo "open:$p" || echo "closed:$p"; done
      echo '--- HTTP /v2/ ---';  curl -i -m 2 "http://$GW:5000/v2/" || true
      echo '--- HTTPS /v2/ ---'; curl -i -k -m 2 "https://$GW:5001/v2/" || true
    displayName: Probe gateway (container)
